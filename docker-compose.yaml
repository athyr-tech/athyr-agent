# Athyr server for testing athyr-agent examples
#
# Usage:
#   OPENROUTER_API_KEY=sk-or-... docker compose up -d
#   docker compose down
#   docker compose logs -f
#
# Without OpenRouter (uses Ollama on host):
#   docker run --rm -p 8080:8080 -p 9090:9090 ghcr.io/athyr-tech/athyr:latest
#
# Verify:
#   curl http://localhost:8080/healthz

services:
  athyr:
    image: ghcr.io/athyr-tech/athyr:latest
    ports:
      - "8080:8080"   # HTTP (REST + health checks)
      - "9090:9090"   # gRPC (agent connections)
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
    volumes:
      - ./docker/athyr.yaml:/app/athyr.yaml:ro
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost:8080/healthz || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 5s
